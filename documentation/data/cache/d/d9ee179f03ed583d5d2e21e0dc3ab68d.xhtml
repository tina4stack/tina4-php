
<h1 class="sectionedit1 heading-combo" id="running_background_tasks_-_tina4_service">Running Background Tasks - Tina4 Service</h1>
<div class="level1">

<p>
Tina4 includes a way to define <strong><a class="link-external link-combo" href="https://en.wikipedia.org/wiki/Service_(systems_architecture)" rel="nofollow ugc">services</a></strong> that will run in the background. This allows you to execute code without having to define CRON jobs. Simply put, services are the functions and instructions you will create that handle the requests and responses for the retrieval of information between servers.  
</p>

<p>
Simply put, services are various functions that make your app, website or system that allows them the capability to perform the various functions created. 
</p>

<p>
Let&#039;s create a service that sends messages. I&#039;ll outline the service bit here. Have a look at <strong><a class="link-internal link-combo" data-wiki-id="tina4:messenger" href="/doku.php?id=tina4:messenger" title="can send email using PHP's built-in mail() function or &lt;https://github.com/PHPMailer/PHPMailer&gt;. This is a PHP built-in function that you can add to you project to handle messages or emails. This is beneficial as we don't need to write out the intense technical functions and server instructions/interactions ourselves.">Sending Email messages with Tina4</a></strong> for more information about sending email.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 100%;">
<p>
Ensure your composer.json includes this line:
</p>
<pre class="code-container-combo code-container-composer.json-combo" data-download-link="true" data-src="file.composer.json">
<code class="language-composer.json code-combo code-composer.json-combo">{
  &quot;name&quot;: &quot;andrevanzuydam/tina4php&quot;,
  &quot;description&quot;: &quot;Tina4 PHP&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;require&quot;: {
    //libraries and components here
  },
    &quot;autoload&quot;: {
    &quot;classmap&quot;: [
        &quot;tina4service&quot;: &quot;@php bin/tina4service&quot;,
        ],
   },   </code>
</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Running Background Tasks - Tina4 Service&quot;,&quot;hid&quot;:&quot;running_background_tasks_-_tina4_service&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1145&quot;} -->
<h1 class="sectionedit4 heading-combo" id="define_your_first_service">Define your First Service</h1>
<div class="level1">
<pre class="code-container-combo code-container-php-combo" data-download-link="true" data-src="src/services/MessengerService.php" data-download-link-label="Download src/services/MessengerService.php">
<code class="language-php code-combo code-php-combo">&lt;?php


class MessengerProcess extends \Tina4\Process implements \Tina4\ProcessInterface 
{

    public string $name = &quot;My Service&quot;;

    function run () 
    {
        echo &quot;Sending Messages&quot;;
        $messages = (new MessageQueue)-&gt;load();
        
        foreach ($messages as $message)
        {
          // Send messages
        }


    }

    function canRun(): bool
    {
       $haveMessages = (New MessageQueue)-&gt;load();
   
       
       if ($haveMessages)
       {
          //We have email messages queued, let the task run
          return true;
       }
       else
       {
          //We have no messages queued
          return false;
       }
}</code>
</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Define your First Service&quot;,&quot;hid&quot;:&quot;define_your_first_service&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1146-1905&quot;} -->
<h2 class="sectionedit5 heading-combo" id="queue_the_service_process">Queue the Service Process</h2>
<div class="level2">
<pre class="code-container-combo code-container-php-combo" data-download-link="true" data-src="file.php">
<code class="language-php code-combo code-php-combo">$service = (new Tina4\Service);
$service-&gt;addProcess(new MessengerProcess(&quot;My Process&quot;));</code>
</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Queue the Service Process&quot;,&quot;hid&quot;:&quot;queue_the_service_process&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;1906-2053&quot;} -->
<h2 class="sectionedit6 heading-combo" id="remove_the_service_process_from_the_queue">Remove the Service Process from the Queue</h2>
<div class="level2">
<pre class="code-container-combo code-container-php-combo" data-download-link="true" data-src="file.php">
<code class="language-php code-combo code-php-combo">(new Tina4\Service)-&gt;removeProcess(&quot;My Process&quot;);</code>
</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Remove the Service Process from the Queue&quot;,&quot;hid&quot;:&quot;remove_the_service_process_from_the_queue&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;2054-2177&quot;} -->
<h2 class="sectionedit7 heading-combo" id="start_tina4service">Start Tina4Service</h2>
<div class="level2">
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_info plugin_wrap" style="width: 100%;">
<p>
You need to add execute permissions on Linux for the tina4service to allow it to execute from the project folder.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} -->
<p>
<strong>
Change the permissions for bin/tina4service in your project directory</strong>
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 100%;">
<pre class="command-line code-container-combo code-container-bash-combo" data-prompt="#" data-download-link="true" data-src="file.bash">
<code class="language-bash code-combo code-bash-combo">chmod +x bin/tina4service</code>
</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;0-&quot;} -->
<p>
<strong>
Start the Service</strong>
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_tip plugin_wrap" style="width: 100%;">
<pre class="command-line code-container-combo code-container-bash-combo" data-prompt="#" data-download-link="true" data-src="file.bash">
<code class="language-bash code-combo code-bash-combo">composer start-service</code>
</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:13,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Start Tina4Service&quot;,&quot;hid&quot;:&quot;start_tina4service&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2178-&quot;} -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//components/prism-core.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/toolbar/prism-toolbar.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/normalize-whitespace/prism-normalize-whitespace.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/show-language/prism-show-language.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/command-line/prism-command-line.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/line-numbers/prism-line-numbers.min.js" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/download-button/prism-download-button.min.js" integrity="sha512-rGJwSZEEYPBQjqYxrdg6Ug/6i763XQogKx+N/GF1rCGvfmhIlIUFxCjc4FmEdCu5dvovqxHsoe3IPMKP+KlgNQ==" crossorigin="anonymous" class="snippet-prism-combo"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0//plugins/autoloader/prism-autoloader.min.js" class="snippet-prism-autoloader-combo"></script>

<script src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" integrity="sha256-LGOWMG4g6/zc0chji4hZP1d8RxR2bPvXMzl/7oPZqjs=" crossorigin="anonymous" class="snippet-anchor-combo"></script>

<script class="snippet-prism-combo">document.addEventListener('DOMContentLoaded', (event) => {

    if (typeof self === 'undefined' || !self.Prism || !self.document) {
        return;
    }

    // Loading the css from https://cdnjs.com/libraries/prism
    const head = document.querySelector('head');
    const baseCdn = "https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/";
    const stylesheets = [
        ["themes/prism-tomorrow.min.css", "sha512-vswe+cgvic/XBoF1OcM/TeJ2FW0OofqAVdCZiEYkd6dwGXthvkSFWOoGGJgS2CW70VK5dQM5Oh+7ne47s74VTg=="],
        ["plugins/toolbar/prism-toolbar.min.css","sha512-DSAA0ziYwggOJ3QyWFZhIaU8bSwQLyfnyIrmShRLBdJMtiYKT7Ju35ujBCZ6ApK3HURt34p2xNo+KX9ebQNEPQ=="],
        /*https://prismjs.com/plugins/command-line/*/
        ["plugins/command-line/prism-command-line.min.css","sha512-4Y1uID1tEWeqDdbb7452znwjRVwseCy9kK9BNA7Sv4PlMroQzYRznkoWTfRURSADM/SbfZSbv/iW5sNpzSbsYg=="],
        /*https://prismjs.com/plugins/line-numbers/*/
        ["plugins/line-numbers/prism-line-numbers.min.css","sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ=="]
    ];

    stylesheets.forEach(stylesheet => {
            let link = document.createElement('link');
            link.rel="stylesheet"
            link.href=baseCdn+"/"+stylesheet[0];
            link.integrity=stylesheet[1];
            link.crossOrigin="anonymous";
            head.append(link);
        }
    )


    Prism.plugins.NormalizeWhitespace.setDefaults({
        'remove-trailing': true,
        'remove-indent': true,
        'left-trim': true,
        'right-trim': true,
    });

    if (!Prism.plugins.toolbar) {
        console.warn('Copy to Clipboard plugin loaded before Toolbar plugin.');

        return;
    }

    let ClipboardJS = window.ClipboardJS || undefined;

    if (!ClipboardJS && typeof require === 'function') {
        ClipboardJS = require('clipboard');
    }

    const callbacks = [];

    if (!ClipboardJS) {
        const script = document.createElement('script');
        const head = document.querySelector('head');

        script.onload = function() {
            ClipboardJS = window.ClipboardJS;

            if (ClipboardJS) {
                while (callbacks.length) {
                    callbacks.pop()();
                }
            }
        };

        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js';
        head.appendChild(script);
    }

    Prism.plugins.toolbar.registerButton('copy-to-clipboard', function (env) {
        var linkCopy = document.createElement('button');
        linkCopy.textContent = 'Copy';
        linkCopy.setAttribute('type', 'button');

        var element = env.element;

        if (!ClipboardJS) {
            callbacks.push(registerClipboard);
        } else {
            registerClipboard();
        }

        return linkCopy;

        function registerClipboard() {
            var clip = new ClipboardJS(linkCopy, {
                'text': function () {
                    return element.textContent;
                }
            });

            clip.on('success', function() {
                linkCopy.textContent = 'Copied!';

                resetText();
            });
            clip.on('error', function () {
                linkCopy.textContent = 'Press Ctrl+C to copy';

                resetText();
            });
        }

        function resetText() {
            setTimeout(function () {
                linkCopy.textContent = 'Copy';
            }, 5000);
        }
    });

});</script>

<script class="snippet-popover-combo">window.addEventListener('load', function () {
    let namespace = "-bs"
    let version = 5;
    if (typeof jQuery != 'undefined' && typeof jQuery.fn.tooltip.constructor.VERSION !== 'undefined') {
        version = parseInt(jQuery.fn.tooltip.constructor.VERSION.substr(0, 1), 10);
        if (version < 5) {
            namespace = "";
        }
        jQuery(`[data${namespace}-toggle="popover"]`).popover();
    } else if (typeof bootstrap.Popover.VERSION !== 'undefined') {
        version = parseInt(bootstrap.Popover.VERSION.substr(0, 1), 10);
        if (version < 5) {
            namespace = "";
        }
        document.querySelectorAll(`[data${namespace}-toggle="popover"]`)
            .forEach(el => {
                new bootstrap.Popover(el);
                // to not navigate on a anchor
                el.onclick = (event => event.preventDefault());
            });
    }
});
</script>

<script class="snippet-anchor-combo">document.addEventListener('DOMContentLoaded', (event) => {
    anchors.options = {
        placement: 'right',
        icon: '#',
        class: 'anchor-combo'
    };
    anchors.add("main > h2").add("main > h3").add("main > h4").add("main > h5").add("main > h6");
});
</script>

<style class="snippet-link-combo">
a.link-external:not(.btn) {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAABdklEQVR4AWMgAVRo1zY3rGk41rC+rqvCBCJWBpPM4WoomLHtdtuv/t9Lfk263TtrQ0t7Oj9cbzZDc/W6s/8T7khD+P+F/8bv29PZlswJVVBu0vPuVZyNYHFZbmAqE1SR0cbjXR6pjGBO58am962Ta3e3ftqy6B5LCcMasOj7gInrm9jBzI4vTX+bfjT/7/4/p/w/zFXybUmt71u4wJzGfxP/t/xvA+KaP2XnQSKVFpWPav/U/6+HKJjz++OVJUDp1n9N/+r+19QyMCz1mPC/8X/X/26Igrn3GiUeL5n/v+F/8//6/9NOMTC0hDUDefP/L4MoOL6ickVeSQ1QqAGooPdBJE/lnloge/fhixBHftFd9bLkR83/+n/1QAXVP8qX1Pyv/L/s/12f/4xQNz8s3Pa/6X/Vvzqgour/5f/r/q//f2fmLy54WP7lfJN74eMSoKIyoNFz/5/+9ar+Px9aZL3Xfjvz7aO3/96+eLvsnSVE7CPhOAYA9nvIX0UoNU8AAAAASUVORK5CYII=);
    background-repeat: no-repeat;
    background-position: 0 center;
    padding: 0 0 0 18px;
}

a.link-mail:not(.btn) {
    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAABOUlEQVR4AaXJMWoUUQDG8f/33ltldyZB3E2xaCAxIQREFKwD2lhb6QmsxMIL6BlU8AhCjmBADdqlWLyACKZKF7LZmUzmzXwiSMTKwl/7478Jng9OXa5fviRzwTS5/j40OcHo2fSofH10tUcXHVg9q54cj3kleOnRj/uHh3e+FVgCbK2drX/dn5xuogAD8uqnyfXZRi3J+tXN2uxj2WwkEgFw0vnW3srmwbU2K2uat2fvi/ObSbII0Kl3VL+9O975PPXEOwe7sb8dZXfqSGB6YWm89Wb+dF+jt+3K3ZoeYUDwwgOjK14wV7tHNXhYUvgEqzUhQeegZVcsSOYBRFeCIXN3ggBoiYYTJBOJIHmhhiWEEHzwl3ycIhjxm5y1nO8FYoJbj268A0D8ISAWj0HQyEOE+Zuwasy//ATU93+97E8p8AAAAABJRU5ErkJggg==);
    background-repeat: no-repeat;
    background-position: 0 center;
    padding: 0 0 0 18px;
}

</style>

<style class="snippet-prism-combo">/* no margin at the bottom / to close to the next paragraph */
.code-toolbar { margin-bottom: 1rem }
</style>

<style class="snippet-historical-breadcrumb-combo">.historical-breadcrumb li {
    margin-bottom: 0.5rem;
}
.historical-breadcrumb a {
    text-decoration: none;
}
.historical-breadcrumb-home {
    max-width: fit-content;
    display: block;
    margin-right: auto;
    margin-left: auto;
    margin-bottom: 1rem;
    padding:0.5rem;
    text-align: center;
    border-radius: calc(.3rem - 1px);
    background-color: #f0f0f0;
}
.historical-breadcrumb-home::before {
    content:'Actual: '
}
</style>

<style class="snippet-message-combo">/*Message*/
.combo-message > .signature {
    font-size: 80%;
    font-style: italic;
    text-align: right;
}
</style>
