
<h1 class="sectionedit1 heading-combo" id="tina4_messenger">Tina4 Messenger</h1>
<div class="level1">

<p>
<strong>Tina4 Messenger</strong> can send email using PHP&#039;s built-in mail() function or <a class="link-external link-combo" href="https://github.com/PHPMailer/PHPMailer" rel="noopener" target="target=_blank">PHPMailer</a>. This is a PHP built-in function that you can add to you project to handle messages or emails. This is beneficial as we don&#039;t need to write out the intense technical functions and server instructions/interactions ourselves. 
</p>

<p>
We recommend PHPMailer if you&#039;re going to need encryption, SMTP authentication, attachments or <a class="link-external link-combo" href="https://en.wikipedia.org/wiki/HTML" rel="noopener" target="target=_blank"><abbr title="HyperText Markup Language">HTML</abbr></a> emails as these features are not supported by mail().
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:2,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_info plugin_wrap">
<p>
Did you know Tina4 Messenger can also send SMS through BulkSMS.com?
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Tina4 Messenger&quot;,&quot;hid&quot;:&quot;tina4_messenger&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-679&quot;} -->
<h2 class="sectionedit4 heading-combo" id="sending_email_with_tina4_messenger">Sending email with Tina4 Messenger</h2>
<div class="level2">

<p>
This example sends email from a route.
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:5,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_info plugin_wrap">
<p>
Add phpmailer to your project for best results: 
</p>
<pre class="command-line code-container-combo code-container-bash-combo" data-prompt="#" data-download-link="true" data-src="file.bash">
<code class="language-bash code-combo code-bash-combo">
  composer require phpmailer/phpmailer</code>
</pre>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:6,&quot;range&quot;:&quot;0-&quot;} -->
<p>
<strong>Define your SMTP Constants</strong>
</p>
<pre class="code-container-combo code-container-env-combo" data-download-link="true" data-src="file.env">
<code class="language-env code-combo code-env-combo">
[Email]
SMTP_USERNAME=&quot;hello@example.com&quot;
SMTP_PASSWORD=&quot;your-mail-password&quot;
SMTP_HOST=&quot;mail.example.com&quot;
SMTP_PORT=587
SMTP_USE_PHPMAILER=true</code>
</pre>

<p>
<strong>Define your Route</strong>
You&#039;ll need a get route as well do display your form if you&#039;re building out a reset password form with email response. 
</p>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:7,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_info plugin_wrap">
<p>
<a class="link-internal link-combo" data-wiki-id="tina4:basic-routing" href="/doku.php?id=tina4:basic-routing" title="The Route of It">Learn Tina4 Routing</a>
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:8,&quot;range&quot;:&quot;0-&quot;} -->
<pre class="code-container-combo code-container-php-combo" data-download-link="true" data-src="index.php" data-download-link-label="Download index.php">
<code class="language-php code-combo code-php-combo">
&lt;?php 

\Tina4\Post::add(&quot;/forgotten-password&quot;, function (\Tina4\Response $response, \Tina4\Request $request) {

 $user = (new User()); // user ORM object
  
 $settings = new \Tina4\MessengerSettings(SMTP_USE_PHPMAILER);
        $settings-&gt;smtpUsername = SMTP_USERNAME;
        $settings-&gt;smtpPassword = SMTP_PASSWORD;
        $settings-&gt;smtpServer = SMTP_HOST;
        $settings-&gt;smtpPort = SMTP_PORT;
        
  $recipients[] = [&quot;name&quot; =&gt; &quot;{$user-&gt;firstName} {$user-&gt;lastName}&quot;, &quot;email&quot; =&gt; $user-&gt;email];

//$data depends on the handlebars variables in your email template. Send email parses the twig template file and replaces these values for you.
  
   (new \Tina4\Messenger($settings))-&gt;sendEmail($recipients, &quot;Email Subject&quot;,
            [&quot;template&quot; =&gt; &quot;/messages/reset.twig&quot;, &quot;data&quot; =&gt; [&quot;firstName&quot; =&gt; $user-&gt;firstName, &quot;username&quot; =&gt; $user-&gt;email, &quot;activationLink&quot; =&gt; &quot;//&quot;.$_SERVER[&quot;HTTP_HOST&quot;].&quot;/activate/{$user-&gt;verificationCode}&quot;] ],
            &quot;example.com&quot;, &quot;hello@example.com&quot;);

 // Add your redirect code here after Debugging the email send             
}            </code>
</pre>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:9,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_tip plugin_wrap">
<p>
Add your email template to the templates directory. In this case reset.twig is in /templates/messages, so we include the /messages/reset.twig
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:10,&quot;range&quot;:&quot;0-&quot;} -->
<p>
<strong>Write out your template file</strong>
Note the handlebars variables in the template file and how they are included above as key value pairs in the data array that your parse to Tina4&#039;s Messenger sendMail method.
</p>
<pre class="code-container-combo code-container-twig-combo" data-download-link="true" data-src="reset.twig" data-download-link-label="Download reset.twig">
<code class="language-twig code-combo code-twig-combo">
Dear {{ firstName }}
&lt;br&gt;
You or someone requested a password reset link from our website, it is important you reset your password.
&lt;br&gt;
Your username is &lt;b&gt;{{ username }}&lt;/b&gt;
&lt;br&gt;
Please click on the following &lt;a href=&quot;{{ activationLink }}&quot;&gt;link&lt;/a&gt; to activate your account and choose a new password
&lt;br&gt;
&lt;br&gt;
Example.com Team</code>
</pre>
<!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_start&quot;,&quot;secid&quot;:11,&quot;range&quot;:&quot;0-&quot;} --><div class="wrap_center wrap_round wrap_tip plugin_wrap">
<p>
Don&#039;t redirect your page when testing your email route. Tina4 Messenger will return useful debugging information in the browser.
</p>
</div><!-- EDIT{&quot;target&quot;:&quot;plugin_wrap_end&quot;,&quot;secid&quot;:12,&quot;range&quot;:&quot;0-&quot;} -->
</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Sending email with Tina4 Messenger&quot;,&quot;hid&quot;:&quot;sending_email_with_tina4_messenger&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;680-&quot;} -->