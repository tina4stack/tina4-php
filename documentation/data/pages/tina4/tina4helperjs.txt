====== Tina4helper.js ======

Tina4PHP includes a helper library that wraps the Jquery calls needed to do the most common Ajax requests on your page. 

<WRAP center round info 100%>
tina4helper.js functions are located in /src/public/js/tina4helper.js
</WRAP>


===== Using loadpage() to load an API route =====
The loadpage() function in Tina4helper.js makes a Get query to any route you specify. By convention we generally put these routes under /api/ in our routes files. But this will work with any route you specify.

So loadpage() takes two arguments, first your route you'd like to make a get request to. And an optional argument to specify the ID of the element you want the response to go to on your page. <div></div> is usually the most appropriate element for this. 

<WRAP center round info 100%>
If you don't specify an ID, loadPage() will look for an element with id = content. I.e. <div id="content"></div>
</WRAP>

Here's an example for using loadPage(). I'll use loadPage() to fetch a loging form. Below I'll include the route I'm calling. Notice that I've included tina4php.js in the head of my file.

<file index.twig>
<?php
<head> 
 <script type="text/javascript" src="/src/public/js/tina4helper.js"></script>
</head>

<button onclick="loadPage('/login', 'content')">Login</button>
<div id="content"></div>

</file>

<file /src/routes/admin/index.php>
\Tina4\Get::add("/login", function (\Tina4\Response $response, \Tina4\Request $request){

    return $response (\Tina4\renderTemplate("screens/login.twig", ["request" => $request->params]), HTTP_OK, TEXT_HTML);
    
});

</file>

So behind the scenes loadPage() is using Jquery make a get request to /api/users". Then takes the content of what is returned from the route and inserts it into my <div id="content"></div>. All without refreshing the page thanks to Ajax being used behind the scenes. 

===== Posting a form with saveForm() =====
saveForm() get's the names of all the form elements inside the form you specify. The posts the data to the url you specify and adds the return into an element of your choice. 

Save form uses Jquery and Ajax to submit your form without reloading the page. This is useful if you want to submit the form without losing the information in the form or rest of your page. This is particularly useful when you want to send back a response from the backend code. 

One of the simplest examples is when a user submits information like an email address that passes your validation on the form. But when you check it in the database you notice that the email address already exists. Now you can send back a message and prompt the user to login/reset their password or use a different email address.

<WRAP center round info 100%>
If you don't specify an ID for the return, saveForm() will look for an element with id = message. I.e. <div id="message"></div>
</WRAP>

<WRAP center round tip 100%>
Each form should have a form token to prevent CSRF (Cross site request forgery). If you forget to include this your form Tina4 will not allow the form to submit as a security precaution. Tina4 has a built-in Twig extension for this. {{  "user" | formToken | raw }}
</WRAP>


Let's see an example of how this works:
<file index.twig>
<?php
<head> 
 <script type="text/javascript" src="/src/public/js/tina4helper.js"></script>
</head>

<button onclick="loadPage('/api/users', 'content')">
<div id="message"></div>

<form id="user" enctype="multipart/form-data" xmlns="http://www.w3.org/1999/html">
    <div class="row">
        <div class="form-group col-md-6">
            <label for="forename">First Name</label>
            <input class="form-control" type="text" name="forename" placeholder="First Name"
                   value="{{ data.firstName }}">
        </div>
        <div class="form-group col-md-6">
            <label for="surname">Last Name</label>
            <input class="form-control" type="text" name="surname" placeholder="Last Name" value="{{ data.surname }}">
        </div>
        <div class="form-group col-md-12">
            <label for="emailAddress">Email</label>
            <input class="form-control" type="text" name="emailAddress" placeholder="Email Address" value="{{ data.emailAddress }}">
        </div>
        <div class="form-group col-md-6">
            <label for="userName">Username</label>
            <input class="form-control" type="text" name="userName" placeholder="Username" value="{{ data.userName }}">
        </div>
        <div class="form-group col-md-6">
            <label for="password">Password</label>
            <input class="form-control" type="password" name="password" placeholder="Password" value="">
        </div>
    {{  "user" | formToken | raw }}
</form>

<script>
    //Prevent form from reloading the page
    jQuery(document).ready(function() {
        $("#user").on().submit(function(e) {
            return false;
        });
    });
</script>

</file>

</file>

<file /src/routes/api/index.php>
\Tina4\Get::post ("/api/users/login", function(\Tina4\Response $response, \Tina4\Request $request) {
    
    if ((New Users)->load("name = $request->userName"))
    {
     //User exists in database validate password...
    }

    return $response (HTTP_OK, APPLICATION_JSON);
});

</file>

Once the information is returned to your route, you need to decide what to do with it. The form fields will be part of the $request object. You could do validation or store the information or anything else you like at this point.

===== Using Show Message =====
showMessage() is useful if you want to return a message into your page without writing out the markup in your route. 

In our example, we have a Bootstrap Alert defined in our Twig template. And when we submit a form, we want to return a message into the alert. 

<file login.twig>

<div id="message" class="alert alert-primary" role="alert">
</div>

</file>

Note how I return just the message without needing to pull any html markup into the route.

<file /src/routes/api/index.php>
\Tina4\Get::post ("/api/users/login", function(\Tina4\Response $response, \Tina4\Request $request) {
    
    if ((New Users)->load("name = $request->userName"))
    {
     //User exists in database validate password...
    }
    else
    {
        $message = "That user was not found, do you want to <a href="/signup">Signup</a>?";
    }

    return $response ($users, HTTP_OK, APPLICATION_JSON);
});

</file>

===== Using showForm() =====
showForm() was written to match Crud Router actions. You'd do well to learn both together, as this makes CRUD so simple it will seem almost seamless. 

By now, you understand how to submit forms and get responses onto your page.

Since Tina4 is a stack and not a framework you're free to use showForm() outside the scope of CRUD router as well. But you'll understand the naming of it's actions better once you've learned how CRUD ROUTER works. 

I'll explain the basic flow for using showForm() with CRUD router.

showForm(action, loadURL, targetDiv) 

==== Actions ====
**form**
Request type: GET
Route: Should include no Id at the end
The form action is used make a get request to your CRUD route and return a blank form

<code>
 showForm('form', /api/users, 'form') 
</code>

**fetch**
Request type: GET
Route: Includes the ID in the end
Used to return a form with twig variables that can populate data into the form. 
Route

<code>
 showForm('fetch', /api/users/213, 'form') 
</code>

**create**
Request type: POST
Post a form to create a new record. Used to submit the form you've requested with the form action. 


<code>
 showForm(create, /api/user, 'form') 
</code>

**edit**
Request type: POST
Post up edited data edit. Used to submit the form you've requested with the fetch action.


<code>
 showForm('edit', /api/user/453, 'form') 
</code>

**delete**
Request type: DELETE
Route: Inlcudes the id in the end
Deletes the record with the current ID.

<code>
 showForm('delete', /api/user/145, 'form') 
</code>

===== Cookies =====
You can create or load cookings with the already written js functions for setting and getting cookies easily. 

==== Saving Cookies with setCookie() ====
setCookie(name,value,days)

<code>
<script>
  setCookie('wishlist',['cookies','cream', 'butter'], 30);
</script>
</code>

==== Loading Cookies with getCookie() ====
getCookie(name)

<code>
<script>
  var $wishlist = getCookie('wishlist');
</script>
</code>
