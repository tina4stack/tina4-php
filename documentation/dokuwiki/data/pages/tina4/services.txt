====== Running Background Tasks - Tina4 Service ======
Tina4 includes a way to define **[[https://en.wikipedia.org/wiki/Service_(systems_architecture)|services]]** that will run in the background. This allows you to execute code without having to define CRON jobs. Simply put, services are the functions and instructions you will create that handle the requests and responses for the retrieval of information between servers.  

Simply put, services are various functions that make your app, website or system that allows them the capability to perform the various functions created. 

Let's create a service that sends messages. I'll outline the service bit here. Have a look at **[[tina4:messenger|Sending Email messages with Tina4]]** for more information about sending email.

<WRAP center round tip 100%>
Ensure your composer.json includes this line:
<code composer.json>
{
  "name": "andrevanzuydam/tina4php",
  "description": "Tina4 PHP",
  "license": "MIT",
  "require": {
    //libraries and components here
  },
    "autoload": {
    "classmap": [
        "tina4service": "@php bin/tina4service",
        ],
   },   
</code>
</WRAP>


====== Define your First Service ======
<code php src/services/MessengerService.php>
<?php


class MessengerProcess extends \Tina4\Process implements \Tina4\ProcessInterface 
{

    public string $name = "My Service";

    function run () 
    {
        echo "Sending Messages";
        $messages = (new MessageQueue)->load();
        
        foreach ($messages as $message)
        {
          // Send messages
        }


    }

    function canRun(): bool
    {
       $haveMessages = (New MessageQueue)->load();
   
       
       if ($haveMessages)
       {
          //We have email messages queued, let the task run
          return true;
       }
       else
       {
          //We have no messages queued
          return false;
       }
}
</code>

===== Queue the Service Process =====
<code php>
$service = (new Tina4\Service);
$service->addProcess(new MessengerProcess("My Process"));
</code>

===== Remove the Service Process from the Queue =====
<code php>
(new Tina4\Service)->removeProcess("My Process");
</code>

===== Start Tina4Service =====

<WRAP center round info 100%>
You need to add execute permissions on Linux for the tina4service to allow it to execute from the project folder.

</WRAP>
**
Change the permissions for bin/tina4service in your project directory** 
<WRAP center round tip 100%>
<code bash>
chmod +x bin/tina4service
</code>
</WRAP>
**
Start the Service**
<WRAP center round tip 100%>
<code bash>
composer start-service
</code>
</WRAP>
